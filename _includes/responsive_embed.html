{% comment %}
Embeds a responsive iframe for a Google Drive link from front matter.
- Handles page.drive_link for embedding.
- Handles page.pdf_url as a fallback for the "Open" button.
- Optionally shows a description and download button.
{% endcomment %}

{%- assign primary_url = page.drive_link | default: page.pdf_url -%}

{%- if primary_url -%}
{%- assign embed_src = "" -%}
{%- assign download_href = "" -%}
{%- assign file_id = "" -%}
{%- assign embed_class = "responsive-embed-container" -%}

{%- if page.drive_link -%}
{%- assign file_id = page.drive_link | split: '/d/' | last | split: '/' | first -%}
{%- if page.drive_link contains '/presentation/' -%}
{%- assign embed_src = "https://docs.google.com/presentation/d/" | append: file_id | append:
"/embed?start=false&loop=false&delayms=3000" -%}
{%- assign download_href = "https://docs.google.com/presentation/d/" | append: file_id | append: "/export/pptx" -%}
{%- elsif page.drive_link contains '/document/' -%}
{%- assign embed_src = "https://docs.google.com/document/d/" | append: file_id | append: "/preview" -%}
{%- assign download_href = "https://docs.google.com/document/d/" | append: file_id | append: "/export?format=docx" -%}
{%- assign embed_class = "responsive-embed-container responsive-embed-container--portrait" -%}
{%- elsif page.drive_link contains '/spreadsheets/' -%}
{%- assign embed_src = "https://docs.google.com/spreadsheets/d/" | append: file_id | append: "/preview" -%}
{%- assign download_href = "https://docs.google.com/spreadsheets/d/" | append: file_id | append: "/export?format=xlsx"
-%}
{%- assign embed_class = "responsive-embed-container responsive-embed-container--portrait" -%}
{%- else -%}
{%- assign embed_src = "https://drive.google.com/file/d/" | append: file_id | append: "/preview" -%}
{%- assign embed_class = "responsive-embed-container responsive-embed-container--portrait" -%}
{%- assign download_href = "https://drive.google.com/uc?export=download&id=" | append: file_id -%}
{%- endif -%}
{%- endif -%}

{%- assign has_header = false -%}
{%- if page.embed_description or download_href != "" or primary_url != "" -%}
{%- assign has_header = true -%}
{%- endif -%}

<div class="embed-section">
  {% if has_header %}
  <div class="embed-header">
    {% if page.embed_description %}
    <p>{{ page.embed_description }}</p>
    {% endif %}
    <div class="embed-header__actions">
      {% if download_href != "" %}
      <a href="{{ download_href }}" class="btn btn--primary btn--small" target="_blank" title="Download file"
        data-track-download data-file-url="{{ download_href }}" data-file-name="{{ page.title | escape }}">
        <i class="fas fa-download"></i> Download
      </a>
      {% endif %}

      <a href="{{ primary_url }}" class="btn btn--secondary btn--small" target="_blank" title="Open in new tab"
        data-track-open data-file-url="{{ primary_url }}" data-file-name="{{ page.title | escape }}">
        <i class="fas fa-external-link-alt"></i> Open
      </a>
    </div>
  </div>
  {% endif %}

  {% if embed_src != "" %}
  <div class="embed-wrapper" id="embed-wrapper-{{ file_id }}">
    <!-- Control Toolbar -->
    <div class="embed-controls">
      <div class="embed-controls__group">
        <span class="embed-hint">Press <kbd>F</kbd> for fullscreen</span>
      </div>
      <div class="embed-controls__group">
        <button class="embed-control-btn" id="fullscreen-toggle-{{ file_id }}" title="Fullscreen (F)">
          <i class="fas fa-expand"></i>
        </button>
      </div>
    </div>

    <!-- Loading Spinner -->
    <div class="embed-loading" id="embed-loading-{{ file_id }}">
      <div class="embed-spinner"></div>
      <p>Loading document...</p>
    </div>

    <!-- Embedded Content -->
    <div class="{{ embed_class }}">
      <iframe src="{{ embed_src }}" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true"
        onload="document.getElementById('embed-loading-{{ file_id }}').style.display='none';">
      </iframe>
    </div>
  </div>
  {% endif %}
</div>
{%- endif -%}